[% WRAPPER wrapper.html.tt %]
    <script src="/js/mapgrid.js" type="text/javascript"></script>
    <script src="/js/heatmap.js" type="text/javascript"></script>
    <div class="page-header">
        <h2>Test Page</h2>
    </div>
    <div class="row">
        <div class="col-lg-12 col-md-12">
            <div class="progress">
                <div class="progress-bar" style="width: 0%" data-current="0" data-total="0"></div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var s = new EventSource('http://api.wotreplays.org/events/packets/52b162f59c81a506e2010000/?' + new Date().getTime());
        var total = 0;
        var current = 0;
        var mc = 0;

        s.onmessage = function(evt) {
            $('.progress-bar').attr('data-mc', ++mc);
        };

        s.addEventListener('start', function(evt) {
            total = parseInt(evt.data);
            $('.progress-bar').attr('data-total', total);
        });

        s.addEventListener('finished', function(evt) {
            s.close();
        });

        s.addEventListener('packet', function(evt) {
            current++;
            var perc = Math.round(100/(total/current));
            $('.progress-bar').css({ 'width': perc + '%' });
            $('.progress-bar').attr('data-current', current);
            $('.progress-bar').attr('data-perc', perc);
        });
    </script>
[% END %]
